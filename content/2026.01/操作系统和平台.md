# 操作系统和平台

分享我使用过的各种操作系统和平台。

我没有提到 nas 是因为我在 nas 上也用 linux；我没有提到 openwrt 是因为我没折腾过路由器；我没有提到 mac 是因为我没那么有钱。

## Termux

对于Termux，我曾经写过 [这篇文章](../2025/Termux.md)，引用其中一句话来介绍Termux：

> termux拥有非常活跃的生态，在“不root安卓系统的情况下使用Linux”这个场景下，termux几乎是唯一的权威，因此它坐拥一个相当大且活跃的社区。

但 termux 只是好玩，我并不觉得它特别有用，我曾经想用 termux 让我的平板具备一些生产力，最后以失败告终。

我看 macbook 搞得不错，生产力极大丰富，续航问题基本消灭，系统流畅，软件生态也受重视，如果加上价格亲民，macbook 就是我们理想中的 termux。

## WSL2

wsl 让 windows 成为最好的 linux 发行版（只是玩梗），没有太多好说的，所有人都应该试试。

1. 入门话题： wsl 的 [官方文档](https://learn.microsoft.com/zh-cn/windows/wsl/) 非常好读，不太需要额外的教程和其它文档。如果实在需要视频教程可以移步 [哔哩哔哩搜索页: wsl](https://search.bilibili.com/all?keyword=wsl)。
2. 但wsl并不是没有**缺点**，我经常使用某个永远有人唱反调的社交平台，如果想了解的话可以移步这个帖子 [你为什么放弃了wsl](https://www.zhihu.com/question/659267767) 。
3. wslg 可以让你在 windows 中直接显示 wsl 中的窗口程序，[这个up主](https://space.bilibili.com/441832003/lists/5917715) 发了不少关于wslg的内容，很有意思。
4. ***wsl 在 2025年5月开源了***，[htts://wsl.dev](htts://wsl.dev) 感兴趣可以看看它的架构文档。
## Docker

用 docker 就像用手机一样自然，我不知道该怎么介绍 docker，所有人都应该试试。

1. 入门话题：我没看过 [docker入门文档](https://docs.docker.com/get-started/)，我不确定文档质量如何，看起来还行。需要入门的新手也可以考虑移步 [哔哩哔哩搜索页：docker](https://search.bilibili.com/all?keyword=docker)。
2. 服务器使用 docker 容易遇到网络问题，我在另一篇文章专门聊这个话题： [国内服务器网络问题](../4.国内服务器网络问题.md)，个人开发者电脑用 docker 直接开虚拟网卡就好了。
3. 如果你喜欢追求一些新东西，可以试试 [podman](https://podman.io/)，它最大的亮点是相比docker没有守护进程（但是守护进程未必是不好的东西，远程访问docker的时候很有用），我曾以为它对 compose 的支持不好而没有尝试，刚刚发现它可以直接调用 docker 的 compose 实现，也可以使用自己的 [podman-compose](https://github.com/containers/podman-compose) ，最近要是有空会尝试一下。

### devcontainer

开发者环境还可以使用 [devcontainer](https://containers.dev/) ，这个工具的思路是在开发环境把项目文件映射到容器内，所有的开发环境的进程都在容器内运行，比如code server(vscode的服务端)、开发时的运行环境比如队列和数据库，或者其他只有开发期会用到的工具。

使用 devcontainer 两个非常大的好处，一是环境隔离，避免这个项目的某些依赖在宿主机中有冲突（拿来隔离vscode插件也是非常好用的），二是可以通过配置文件定义开发环境，即使时过境迁沧海桑田，你也可以快速获得一整套一模一样的开发环境。

我曾经一度给我所有的仓库都使用 devcontainer，但其实没必要，对于只需要 node_modules 和 venv 的简单项目，大多数时候不需要 devcontainer 也可以隔离依赖。

devcontainers 一个很有趣的地方是 features ，它的思路是声明式的定义需要的工具，它就会为我执行某些社区维护的脚本来自动安装，像这样写devcontainer.json：

```json
"features": {
    "ghcr.io/rocker-org/devcontainer-features/pandoc:latest": {
        "version": "2.17"
    }
}
```

声明式定义环境在 devops 中早就司空见惯了，我有一段时间甚至对“每个工具都要强调自己是声明式的”这件事有点厌烦。直到发现 devcontainer features 能够让我在 dockerfile 中少花很多时间，我才知道声明式定义环境原来这么方便。

但是 features 在使用上有一个很影响体验的缺点，就是每次创建容器的时候，镜像可以用构建缓存，但是features脚本需要重新执行，没有缓存。

我大约在一年前发现了features的缓存问题，至今一直不知道如何解决，刚刚随手翻查了 devcontainer 的文档，注意到一篇讲 [预构建](https://containers.dev/guide/prebuild) 的文档，我注意到 预构建 + features 不仅可以彻底解决features缓存问题，还能解决 docker 构建不能声明式定义的问题，通过devcontainer cli 可以连同 features 一起构建镜像，这样以后就只需要写 features（实际上就是写shell脚本），不需要再折腾 dockerfile 了，dockerfile 真的很不方便调试。


## 关于虚拟化的插叙

前三个话题有一个共同特点就是虚拟化，我在接触这些工具的过程中对操作系统、虚拟化和容器化加深了很多理解：
1. wsl2 优秀的性能是得益于微软的 hyperv 是一个 type1 的 hypervisor，这意味着windows 和 wsl2 哥俩好地一起运行在 hypverv 上，而不是 linux 运行在 windows 上，那会让 linux 奇慢无比。
2. 容器的启动速度之所以比虚拟机快，是因为容器其实是操作系统在数据结构和逻辑层面上进行隔离的一组进程，这也限制了容器只能在 linux 上运行。
	1. windows 上的 docker desktop 通过 wsl2 运行容器。
	2. 苹果的 Containerization 也能够运行容器，是因为它为每一个 Linux 容器分配一个极简的、深度集成Apple Silicon的专用虚拟机。
3. 读完《操作系统导论》的虚拟化部分之后，更进一步了解了进程和内存的虚拟化，我开始理解虚拟机平台和操作系统面临一个共同的问题：如何把资源分配给运行在平台上的程序，解决这个问题的一整套方案就是虚拟化技术。

## 多系统

“如何安装双系统” 是一个高质量教程云集的入门话题，想要入门可以移步：[哔哩哔哩搜索页：如何安装双系统](https://search.bilibili.com/all?keyword=%E5%A6%82%E4%BD%95%E5%AE%89%E8%A3%85%E5%8F%8C%E7%B3%BB%E7%BB%9F) 

要烧录启动U盘我推荐 [rufus](https://rufus.ie/zh/)，这是一个轻量的专门用于烧录的应用，只有几MB，只能在windows上用。另外还推荐 [ventory](https://www.ventoy.net/cn/index.html)（多平台可用），引用ventory官网的话来介绍它：

> 简单来说，Ventoy是一个制作可启动U盘的开源工具。  
> 
> 有了Ventoy你就无需反复地格式化U盘，你只需要把 ISO/WIM/IMG/VHD(x)/EFI 等类型的文件直接拷贝到U盘里面就可以启动了，无需其他操作。  
> 
> 你可以一次性拷贝很多个不同类型的镜像文件，Ventoy 会在启动时显示一个菜单来供你进行选择 (参见 [截图](https://www.ventoy.net/cn/screenshot.html))。  
> 
> 你还可以在 Ventoy 的界面中直接浏览并启动本地硬盘中的 ISO/WIM/IMG/VHD(x)/EFI 等类型的文件。  
> 
> Ventoy 安装之后，同一个U盘可以同时支持 x86 Legacy BIOS、IA32 UEFI、x86_64 UEFI、ARM64 UEFI 和 MIPS64EL UEFI 模式，同时还不影响U盘的日常使用。  
> 
> Ventoy 支持大部分常见类型的操作系统 （Windows/WinPE/Linux/ChromeOS/Unix/VMware/Xen ...）

### 管理系统引导

“引导”就是指按下开机键之后，主板上的固件程序查找可用的操作系统并启动的过程，英文叫做Boot，其实就是启动的意思，“引导”是专门描述这个过程的术语。

在管理系统引导之前至少要先知道引导的具体过程。我个人觉得系统引导学起来很艰苦，我常常忘记自己经历过的苦难，但是学操作系统引导时的苦难感，让我时至今日写这段文字的时候都面露难色。这可能和网上有大量的关于引导过程的错误言论有关，2014年的文章中也都说网上大部分信息都是错误的，看来直至最近几年都没有改善。

如果你想了解正确的知识，我有一份推荐的阅读列表，原谅我推荐的都是比较老的文章，因为UEFI真的早就普及了，虽然他们的文章也算是二手知识，但至少不是十八手知识，而且我建议你一遍看他们的文章，一边浏览你的ESP分区来验证（看看可以，不建议乱动）。

1. [《UEFI 启动是如何工作的? 》](https://www.happyassassin.net/posts/2014/01/25/uefi-boot-how-does-that-actually-work-then/) 作者 Adam Williamson，写于2014年，文章用语介于通俗和专业之间，介绍了旧的BIOS的工作方式，UEFI是如何从问题出发来进行设计的，以及Boot Manager和Secure Boot。这篇文章写的非常好，我担心原链接丢失所以把这篇文章的原网页制作成了google机翻的 [中英双语版PDF](assets/6.操作系统和平台/UEFI_boot_how_does_that_actually_work_Adam_Williamson.pdf) ，看起来内容很多，但实际上这个网页有四分之三都是评论。
2. [《管理UEFI Boot Loader》](https://www.rodsbooks.com/efi-bootloaders/index.html) 作者Rod Smith，写于2011。Rod Smith在他的网站中写了很多关于系统引导的文章，很权威。

如果真的很想追求一手知识，那就去读[《UEFI Specification 2.11》](https://uefi.org/specs/UEFI/2.11/) ，一般可以在 [UEFI论坛](https://uefi.org/) 找到最新版。


## Kubernetes

前面说的大多是开发者电脑上个人用户的玩具，Kubernetes 才是真实世界的生产力，是云原生的象征和核心。

让我们从宏观层面开始，云原生领域最权威的组织叫做CNCF(Cloud native computing foundation)，它有一个项目叫做 [CNCF 云原生全景图](https://landscape.cncf.io/) ，全方位的、大规模的展示了云原生所有子领域的发展情况和代表项目，并对每个子领域进行科普性的介绍。

k8s的第一难就是安装，我有一篇文章详细说明了 [国内通过kubeadm安装k8s的困难和解决方案](2025/k8s-installation.md) 。kubeadm 的安装方式有助于加强对k8s的理解，但其实并不实用。对于开发环境，推荐使用 [kind](https://kind.sigs.k8s.io/)，让容器成为k8s节点；也可以使用[k3s](https://k3s-io.github.io/)，通过一个二进制文件运行极小的、高度集成的k8s。