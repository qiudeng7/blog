# ubuntu 和 windows 双系统

最近又有装双系统的念头，我曾经装过双 windows，也装过 linux+windows，现在计划改成 win+win+ubuntu 下面是我的思考过程。

1. 打 apex 太卡了，我觉得是目前的 win11 系统不够纯净导致的，我装了很多日常用的和开发用的软件，我应该安装一个 win10+linux 的双系统。
2. 看了一些网上的测试之后发现 win11 和 win10 在游戏性能上难分伯仲，和不同游戏各自的优化有很大的关系，换成 win10 也未必就能提升 apex 帧数。
3. 另外根据以前的经验， linux 在日用体验上有很多各种各样不方便的小毛病需要自己找办法解决：已经解决的比如输入法，比如更换桌面环境；没有自己解决过的比如字体渲染，比如双系统切换会导致时间异常，比如浏览网页触摸板速度异常等等。
   1. 当然这些问题肯定都是可以解决的，只是需要成本。
4. 而且如果说 linux 用来工作，不需要优化太多体验细节，能跑就行，win10 也只用来打游戏，那日常使用电脑用什么系统呢？如果用 win10，最后系统还是会装各种各样的软件，如果再装一个新系统，三系统切换又非常麻烦，这背后的核心原因是我的娱乐和生活是有重合的，生活和工作也是有重合的。
5. 最终的方案是当前系统仍然作为主力系统运行很多杂七杂八的东西，只把两个比较纯粹的和生活无关的需求拆解成两个精简系统，一个是纯粹打 apex 的 win10，一个是纯粹工作的 ubuntu。

---

## 无 usb 安装 win+ubuntu 双系统

参考 [system installation - How can I install Ubuntu without CD and USB? - Ask Ubuntu](https://askubuntu.com/questions/484434/how-can-i-install-ubuntu-without-cd-and-usb)，使用 `For UEFI devices` 方案。

第一步，下载 [refind](http://sourceforge.net/projects/refind/files/) 并解压，refind 是一个 boot manager。

第二步，用 diskgenius 把解压了的 refind 目录复制到 ESP 分区的 EFI 目录下（`S:\EFI\refind`，这个 refind 目录下需要有 `refind_x64.efi`、`refind.conf-sample` 等文件）

然后把 `S:\EFI\refind` 里的 `refind.conf-sample` 改名为 `refind.conf`。

第三步，打开一个有管理员权限的 cmd, 执行：

```batch
:: S: 表示ESP分区，`/S`表示给该分区添加一个S盘符。
:: 不确定这一步是不是必要的
mountvol S: /S

:: cd到refind目录，不确定这一步是不是必要的
cd S:\EFI\refind

:: 编辑系统引导为这个refind的efi文件，如果是非x64的自己选择它类型的。
bcdedit /set {bootmgr} path \EFI\refind\refind_x64.efi
```

这一步会修改 windows 使用 refind 作为系统引导。

第四步，创建一个 4G 左右的 fat32 分区，然后把系统 iso 解压进去，这个分区将作为 liveCD。

第五步，重启电脑就会进入 refind，选择这个 liveCD 即可。

## 中文输入法

开启中文支持： Settings -> Region & Language -> Manage installed Languages -> Install / Remove Languages -> 点选 Chinese (simplified) -> Apply

添加拼音输入法： Settings -> Region & Language -> Input Sources -> + -> Chinese -> Chinese (Intelligent Pinyin)
如果没有拼音输入法 则可以 `sudo apt install ibus-pinyin`

## 搜狗输入法

搜狗输入法官方提供了一个 deb 包，没有登录功能，安装这个 deb 包之后，在设置页面把输入法框架改为 fcitx，然后安装搜狗的依赖：

```bash
sudo apt install libqt5qml5 libqt5quick5 libqt5quickwidgets5 qml-module-qtquick2
sudo apt install libgsettings-qt1
```

这时候重启应该就能够使用搜狗输入法了，但是可能会在终端可使用但是浏览器无法使用，需要补充安装一些东西：

```bash
sudo apt install *gtk4
```

1. 系统显示文字不必设置为中文，只需要下载中文的语言包即可。
2. ibus 应该可以不删除，只要不要同时启动 ibus 和 fcitx 就好了。
3. 设置 win+space 切换输入法需要在设置里先关闭 win+space 的快捷键，然后在 fcitx 的设置里才能用。

## 浏览器异体字

解决办法参考 https://tieba.baidu.com/p/4879946717

大概原因是在英文的系统中，显示中文时，日语字体排在中文字体前面所以会显示异体字，需要手动调整顺序。

```bash
调整偏好顺序
sudo cat > /etc/fonts/conf.avail/64-language-selector-prefer.conf  <<EOF
<?xml version="1.0"?>
<!DOCTYPE fontconfig SYSTEM "fonts.dtd">
<fontconfig>
<alias>
<family>sans-serif</family>
<prefer>
<family>Noto Sans CJK SC</family>
<family>Noto Sans CJK TC</family>
<family>Noto Sans CJK JP</family>
</prefer>
</alias>
<!--以上为设置无衬线字体优先度-->
<alias>
<family>monospace</family>
<prefer>
<family>Noto Sans Mono CJK SC</family>
<family>Noto Sans Mono CJK TC</family>
<family>Noto Sans Mono CJK JP</family>
</prefer>
</alias>
<!--以上为设置等宽字体优先度-->
</fontconfig>
EOF

sudo ln -s /etc/fonts/conf.avail/64-language-selector-prefer.conf /etc/fonts/conf.d/64-language-selector-prefer.conf

# 如果存在 /etc/fonts/conf.d/64-language-selector-cjk-prefer.conf，把这个文件的内容也改成上面的 xml

# 更新字体缓存
fc-cache -fv

# 检查字体匹配优先
# 如果显示的是 "Noto Sans CJK SC" 则表示成功，如果不是 CJK 而是 JP 则仍然为异体字。
fc-match -s | grep NotoSansCJK-Regular.ttc 
```

## show apps 按钮居左

`show apps` 按钮类似 windows 的开始菜单，放在左下角习惯一点。下面这个写 true 就是左边，false 就是右边。

```bash
gsettings set org.gnome.shell.extensions.dash-to-dock show-apps-at-top true
```

## 处理 appimage

ubuntu 下使用 appimage 双击无法直接打开，在终端执行 appimage 文件的时候提示需要 FUSE，查看 FUSE 的 [wiki](https://github.com/AppImage/AppImageKit/wiki/FUSE) 发现 ubutnu 安装 fuse 的方法：

```bash
sudo add-apt-repository universe
sudo apt install libfuse2t64
```

但是 appimage 不会在“在系统中注册”，我们可以手动处理，或者使用自动注册 appimage 的工具。自动注册工具的可选项有 AppImageLauncher 和 appimaged，试过了都不好用，不好处理 sandbox。

手动处理参考

1. https://zhuanlan.zhihu.com/p/1923316954887873371
2. https://forum.cursor.com/t/tutorial-install-cursor-permanently-when-appimage-install-didnt-work-on-linux/7712

以安装 cursor 为例，第一步，创建一个 cursor 的应用目录，下载 cursor appimage 到这里

```bash
mkdir -p ~/app/cursor
```

第二步，给 `cursor.AppImage` 添加可执行权限

```bash
chmod +x cursor.AppImage
```

第三步，把 [cursor 图标](https://us1.discourse-cdn.com/cursor1/original/2X/f/f7bc157cca4b97c3f0fc83c3c1a7094871a268df.png) 放到 `~/app/cursor` 目录下

第四步，创建一个 desktop entry:

```bash
cat > ~/.local/share/applications/cursor.desktop <<EOF
[Desktop Entry]
Name=cursor
Exec=/home/qiudeng/app/cursor/cursor.AppImage --no-sandbox
Icon=/home/qiudeng/app/cursor/logo.png
Type=Application
Categories=Utility;Development;
EOF
```

然后在应用程序列表搜索 cursor 就可以搜到了。 这个 desktop entry 还可以放在桌面或者 `/usr/share/applications`

